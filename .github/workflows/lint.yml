name: Lint

on:
  push:
    branches: [ main, master, develop ]
  pull_request:
    branches: [ main, master, develop ]

jobs:
  clang-format:
    runs-on: ubuntu-latest
    
    steps:
    - uses: actions/checkout@v4
    
    - name: Install clang-format
      run: |
        sudo apt-get update
        sudo apt-get install -y clang-format
    
    - name: Check code formatting
      run: |
        find src -name "*.c" -o -name "*.h" | while read file; do
          echo "Checking $file"
          clang-format --dry-run --Werror "$file"
        done
      continue-on-error: true

  cppcheck:
    runs-on: ubuntu-latest
    
    steps:
    - uses: actions/checkout@v4
    
    - name: Install cppcheck
      run: |
        sudo apt-get update
        sudo apt-get install -y cppcheck
    
    - name: Run static analysis
      run: |
        cppcheck --enable=warning,style,performance,portability \
          --suppress=missingIncludeSystem \
          --error-exitcode=0 \
          src/
      continue-on-error: true
